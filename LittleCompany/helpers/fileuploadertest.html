<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>

    <script src="../webresources/script/jquery-2.0.3.min.js"></script>

    <script>

        var selectedFiles = 0;
        var datatoupload = new FormData();

        $(document).ready(function () {
            var box;
            box = document.getElementById("box");
            box.addEventListener("dragenter", OnDragEnter, false);
            box.addEventListener("dragover", OnDragOver, false);
            box.addEventListener("drop", OnDrop, false);



            $("#upload").click(function () {
               // var data = new FormData();
               
                $.ajax({
                    type: "POST",
                    url: "functions.ashx?token=74349c6378a3498fb2ca20d669f14cd3&action=uploadfiles",
                    contentType: false,
                    processData: false,
                    data: datatoupload,
                    success: function (result) {
                        alert(result.messages.join("\n"));
                        if (result.ispositive && result.data) {
                            DownloadFile(result.data);
                        }
                    },
                    error: function () {
                        alert("There was error uploading files!");
                        alert(result.messages.join("\n"));
                    }
                });
            });


        });

        function DownloadFile(data) {
            var filestodownload = data;

            var fileid = data[0].versions[0].id;

            window.open("functions.ashx?token=74349c6378a3498fb2ca20d669f14cd3&action=getfile&fileid=" + fileid);


        }



        function OnDragEnter(e) {
            e.stopPropagation();
            e.preventDefault();
            $("#box").css("background-color", "");
        }
 
        function OnDragOver(e) {
            e.stopPropagation();
            e.preventDefault();

            $("#box").css("background-color", "#a90808");
        }
 
        function OnDrop(e) {
            e.stopPropagation();
            e.preventDefault();

            
             var l = e.dataTransfer.files.length;
             for (var i = 0; i < l; i++) {
                 var sf = e.dataTransfer.files[i]
                 datatoupload.append(sf.name, sf);
                 selectedFiles++;
             }


            $("#box").text(selectedFiles + " file(s) selected for uploading!");
        }




    </script>



</head>
<body>
    <form id="form1" runat="server">
        <center>
            <div id="box" style="border:solid 1px #cccccc;">Drag & Drop files from your machine on this box.</div>
            <br />
            <input id="upload" type="button" value="Upload Selected Files" />
        </center>
    </form>
</body>
</html>


